<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CATÁLOGO DE PRODUCTOS</title>
  <link rel="stylesheet" href="styles.css" />

  <!-- 🧷 Dependencias de PayPhone -->
  <link rel="stylesheet" href="https://cdn.payphonetodoesposible.com/box/v1.1/payphone-payment-box.css">
  <script type="module" src="https://cdn.payphonetodoesposible.com/box/v1.1/payphone-payment-box.js"></script>
</head>
<body>
  <header>
    <h1>CATÁLOGO DE PRODUCTOS</h1>
  </header>

  <main>
    <div id="product-list" class="product-container"></div>

    <section class="carrito-section">
      <h2>🛒 Carrito</h2>
      <ul id="cart" class="cart-list"></ul>
      <p>Total: $<span id="cart-total">0.00</span></p>

      <!-- Botón decorativo previo -->
      <button id="pay-button" onclick="document.getElementById('pp-button').scrollIntoView({ behavior: 'smooth' });">Pagar con PayPhone</button>

      <!-- 📦 Contenedor botón PayPhone -->
      <div id="pp-button" style="margin-top: 20px;"></div>
        </section>
      </main>

      <script src="script.js"></script>

      <!-- ⚙️ Configuración PayPhone dinámica -->
      <script>
        let ppb = null;

        function renderPayPhoneBox(total) {
      // Elimina la caja anterior si existe
      if (ppb && typeof ppb.destroy === 'function') {
        ppb.destroy();
      }
      // Calcula valores de impuestos y totales (ajusta según tu lógica)
      const amount = Math.round(total * 100); // PayPhone espera centavos
      const tax = Math.round(total * 0.12 * 100); // 12% IVA ejemplo
      const amountWithoutTax = amount - tax;
      const amountWithTax = amount;
      // Renderiza la caja de pago con los valores actuales
      ppb = new PPaymentButtonBox({
        token: 'qdkhpAskl56ppaqtybvmimdiCSnRlKdQkczqEUs1c8Y_c0tCi2QK49Lyw5y_Xsku9q6iQCM8duJpAUhoBofyCcYfVsXFhPJnhANQUVNyyFQDBkjeUtLoWv4VPvYDq8o5h6XwRPhA9MVi1t_dGyF41x3wAAh_GEih9OUl96oDvFTeJMGY4ZEcjkPSJMu3GpWyep4O6PF33KeoRimcsT17ql8psoAa0ey6dgq3xYKJRvH22sE_FYRowqblH9bcDt9sI_gO1GiNRy6QPqLo1lm0L7PXGbJNhIBxF20Ss5icK7eZFuvTumbDLktLaZmdCNSZZN4LmByeZYCjRy0c_NtW2G6v4iw',
        clientTransactionId: 'transaccion-001-' + Date.now(),
        amount: amount,
        amountWithoutTax: amountWithoutTax,
        amountWithTax: amountWithTax,
        tax: tax,
        service: 0,
        tip: 0,
        currency: "USD",
        storeId: "be384310-ebe7-423a-9584-eebdebe1012e",
        reference: "Pago por venta Fact#001",
        lang: "es",
        defaultMethod: "card",
        timeZone: -5,
        lat: "-1.831239",
        lng: "-78.183406",
        optionalParameter: "Parametro opcional",
        phoneNumber: "+593999999999",
        email: "cliente@email.com",
        documentId: "1234567890",
        identificationType: 1
      }).render('pp-button');
        }

        // Escucha cambios en el total del carrito
        function getCartTotal() {
      const totalSpan = document.getElementById('cart-total');
      return parseFloat(totalSpan.textContent) || 0;
        }

        // Observa cambios en el total y actualiza la caja de pago
        const cartTotalSpan = document.getElementById('cart-total');
        const observer = new MutationObserver(() => {
      const total = getCartTotal();
      renderPayPhoneBox(total);
        });
        observer.observe(cartTotalSpan, { childList: true });

        // Renderiza la caja de pago al cargar la página
        window.addEventListener('DOMContentLoaded', () => {
      renderPayPhoneBox(getCartTotal());
        });
      </script>
    </body>
    </html>
